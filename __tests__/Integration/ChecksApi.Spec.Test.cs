/*
 * Lob
 *
 * The Lob API is organized around REST. Our API is designed to have predictable, resource-oriented URLs and uses HTTP response codes to indicate any API errors. <p> Looking for our [previous documentation](https://lob.github.io/legacy-docs/)?
 *
 * The version of the OpenAPI document: 1.3.0
 * Contact: lob-openapi@lob.com
 * Generated by: https://github.com/openapitools/openapi-generator.git
 */

using lob.dotnet.Client;
using lob.dotnet.Api;
using lob.dotnet.Model;
using NUnit.Framework;
using System;
using System.Collections.Generic;
using System.Linq;

namespace __tests__.Integration {
    [TestFixture]
    [Parallelizable(scope: ParallelScope.Self)]
    public class ChecksApiTests : IDisposable
    {
        private ChecksApi validApi;
        private ChecksApi invalidApi;
        private CheckEditable checkEditable;
        private List<string> idsToDelete;

        private Address address1;
        private Address address2;
        private AddressesApi validAddressesApi;
        private BankAccount bankAccount;
        private BankAccountsApi validBankAccountsApi;

        public ChecksApiTests()
        {
            Configuration config = new Configuration();
            Configuration invalidConfig = new Configuration();

            DotNetEnv.Env.TraversePath().Load();
            config.Username = System.Environment.GetEnvironmentVariable("LOB_API_TEST_KEY");
            invalidConfig.Username = "fake api key";

            validApi = new ChecksApi(config);
            invalidApi = new ChecksApi(invalidConfig);

            BankAccountWritable bankAccountWritable = new BankAccountWritable();
            bankAccountWritable.setDescription("Test Bank Account");
            bankAccountWritable.setRoutingNumber("322271627");
            bankAccountWritable.setAccountNumber("123456789");
            bankAccountWritable.setAccountType(BankTypeEnum.Individual);
            bankAccountWritable.setSignatory("Sinead Connor");

            validBankAccountsApi = new BankAccountsApi(config);
            bankAccount = validBankAccountsApi.BankAccountCreate(bankAccountWritable);

            List<int> amounts = new List<int>();
            amounts.Add(11);
            amounts.Add(35);

            BankAccountVerify verification = new BankAccountVerify();
            verification.setAmounts(amounts);
            validBankAccountsApi.BankAccountVerify(bankAccount.getId(), verification);

            AddressEditable addressEditable1 = new AddressEditable();
            addressEditable1.setAddressLine1("1313 CEMETERY LN");
            addressEditable1.setAddressCity("WESTFIELD");
            addressEditable1.setAddressState("NJ");
            addressEditable1.setAddressZip("07000");
            addressEditable1.setAddressCountry(CountryExtended.US);
            addressEditable1.setDescription("test description");
            addressEditable1.setName("Thing T. Thing");

            AddressEditable addressEditable2 = new AddressEditable();
            addressEditable2.setAddressLine1("001 CEMETERY LN");
            addressEditable2.setAddressLine2("SUITE 666");
            addressEditable2.setAddressCity("WESTFIELD");
            addressEditable2.setAddressState("NJ");
            addressEditable2.setAddressZip("07000");
            addressEditable2.setAddressCountry(CountryExtended.US);
            addressEditable2.setName("FESTER");

            validAddressesApi = new AddressesApi(config);
            address1 = validAddressesApi.AddressCreate(addressEditable1);
            address2 = validAddressesApi.AddressCreate(addressEditable2);

            checkEditable = new CheckEditable();
            checkEditable.setFrom(address1.getId());
            checkEditable.setTo(address2.getId());
            checkEditable.setBankAccount(bankAccount.getId());
            checkEditable.setAmount(100);
            checkEditable.setDescription("check 1");

            idsToDelete = new List<string>();
        }

        public void Dispose()
        {
            validBankAccountsApi.BankAccountDelete(bankAccount.getId());
            validAddressesApi.AddressDelete(address1.getId());
            validAddressesApi.AddressDelete(address2.getId());
            idsToDelete.ForEach(id => validApi.CheckCancel(id));
        }

        [Test]
        public void CheckCreateTest() {
            Check response = validApi.CheckCreate(checkEditable);

            Assert.NotNull(response.getId());
            idsToDelete.Add(response.getId());
            Assert.AreEqual(response.getDescription(), checkEditable.getDescription());
        }

        [Test]
        public void CheckCreateTestBadParameter() {
            try {
                Check response = validApi.CheckCreate(null);
            }
            catch (Exception e) {
                Assert.IsInstanceOf<ApiException>(e);
                Assert.That(e.Message, Does.Contain("Missing required parameter 'checkEditable'"));
            }
        }

        [Test]
        public void CheckCreateTestBadUsername() {
            try {
                Check response = invalidApi.CheckCreate(checkEditable);
            }
            catch (Exception e) {
                Assert.IsInstanceOf<ApiException>(e);
                Assert.That(e.Message, Does.Contain("Your API key is not valid"));
            }
        }

        [Test]
        public void CheckRetrieveTest() {
            Check check = validApi.CheckCreate(checkEditable);
            idsToDelete.Add(check.getId());
            Check response = validApi.CheckRetrieve(check.getId());

            Assert.NotNull(response.getId());
            Assert.AreEqual(response.getId(), check.getId());
        }

        [Test]
        public void CheckRetrieveTestBadParameter() {
            try {
                Check response = validApi.CheckRetrieve(null);
            }
            catch (Exception e) {
                Assert.IsInstanceOf<ApiException>(e);
                Assert.That(e.Message, Does.Contain("Missing required parameter 'chkId'"));
            }
        }

        [Test]
        public void CheckRetrieveTestBadUsername() {
            Check check = validApi.CheckCreate(checkEditable);
            idsToDelete.Add(check.getId());
            try {
                Check response = invalidApi.CheckRetrieve(check.getId());
            }
            catch (Exception e) {
                Assert.IsInstanceOf<ApiException>(e);
                Assert.That(e.Message, Does.Contain("Your API key is not valid"));
            }
        }

        [Test]
        public void CheckListTest() {
            CheckList response = validApi.ChecksList(null, null, null, null, null, null, null, null, null, null);

            Assert.Greater(response.getCount(), 0);
        }

        [Test]
        public void CheckListTestWithLimitParameter() {
            int limit = 2;
            CheckList response = validApi.ChecksList(limit, null, null, null, null, null, null, null, null, null);

            Assert.AreEqual(response.getCount(), 2);
        }

        [Test]
        public void CheckListTestWithIncludeParameter() {
            List<string> includeList = new List<string>();
            includeList.Add("total_count");

            CheckList response = validApi.ChecksList(null, null, null, includeList);
            Assert.Greater(response.getCount(), 0);
            Assert.NotNull(response.getTotalCount());
        }

        [Test]
        public void CheckListTestWithDateCreatedParameter() {
            Dictionary<String, DateTime> dateCreated = new Dictionary<String, DateTime>();
            DateTime lastMonth = DateTime.Today.AddMonths(-1);
            dateCreated.Add("lt", lastMonth);

            CheckList response = validApi.ChecksList(null, null, null, null, dateCreated);
            Assert.Greater(response.getCount(), 0);
        }

        [Test]
        public void CheckListTestWithMetadataParameter() {
            Dictionary<String, String> metadata = new Dictionary<String, String>();
            metadata.Add("name", "Harry");

            CheckList response = validApi.ChecksList(null, null, null, null, null, metadata);
            Assert.Greater(response.getCount(), 0);
        }

        [Test]
        public void CheckListTestWithScheduledParameter() {
            Boolean scheduled = true;

            CheckList response = validApi.ChecksList(null, null, null, null, null, null, scheduled);
            Assert.Greater(response.getCount(), 0);
        }

        [Test]
        public void CheckListTestWithSendDateParameter() {
            Dictionary<String, String> sendDate = new Dictionary<String, String>();
            DateTime lastMonth = DateTime.Today.AddMonths(-1);
            sendDate.Add("lt", lastMonth.ToString("yyyy-MM-ddTHH\\:mm\\:ss.fffffffzzz"));

            CheckList response = validApi.ChecksList(null, null, null, null, null, null, null, sendDate);
            Assert.Greater(response.getCount(), 0);
        }

        [Test]
        public void CheckListTestWithMailTypeParameter() {
            MailType mailType = MailType.FirstClass;

            CheckList response = validApi.ChecksList(null, null, null, null, null, null, null, null, mailType);
            Assert.GreaterOrEqual(response.getCount(), 0);
        }

        [Test]
        public void CheckListTestWithSortByParameter() {
            SortBy5 sortBy = new SortBy5();
            sortBy.setSendDate(SortBy5.SendDateEnum.Asc);
            CheckList response = validApi.ChecksList(null, null, null, null, null, null, null, null, null, sortBy);
            Assert.Greater(response.getCount(), 0);
        }
    }
}